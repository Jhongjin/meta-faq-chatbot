<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Railway AdMate ë°°í¬ ê°€ì´ë“œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            animation: fadeInDown 0.8s ease;
        }
        
        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            animation: fadeInUp 0.8s ease;
        }
        
        .content {
            padding: 40px;
        }
        
        h2 {
            color: #667eea;
            margin: 30px 0 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            animation: slideInLeft 0.6s ease;
        }
        
        h3 {
            color: #764ba2;
            margin: 20px 0 15px;
        }
        
        .problem-section {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .solution-section {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
        }
        
        code {
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 14px;
        }
        
        .inline-code {
            background: #f0f0f0;
            color: #e83e8c;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Fira Code', 'Courier New', monospace;
        }
        
        .file-header {
            background: #667eea;
            color: white;
            padding: 10px 15px;
            border-radius: 8px 8px 0 0;
            margin-bottom: -15px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .copy-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .copy-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        ul, ol {
            margin-left: 30px;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        
        li {
            margin: 8px 0;
        }
        
        .step-number {
            display: inline-block;
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            text-align: center;
            line-height: 30px;
            border-radius: 50%;
            margin-right: 10px;
            font-weight: bold;
        }
        
        .warning {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .env-var {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .env-var-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 4px;
        }
        
        .env-var-name {
            font-weight: bold;
            color: #667eea;
            min-width: 150px;
        }
        
        .env-var-value {
            color: #666;
            font-family: 'Fira Code', monospace;
        }
        
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .footer {
            background: #f8f9fa;
            padding: 30px;
            text-align: center;
            color: #666;
            border-top: 1px solid #dee2e6;
        }
        
        .github-link {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background: #24292e;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .github-link:hover {
            background: #1a1e22;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸš€ Railway AdMate ë°°í¬ ê°€ì´ë“œ</h1>
            <p class="subtitle">Ollamaì™€ FastAPIë¥¼ Railwayì— ë°°í¬í•˜ê¸°</p>
        </header>
        
        <div class="content">
            <div class="problem-section">
                <h2>ğŸ” ì£¼ìš” ë¬¸ì œì ë“¤</h2>
                <ol>
                    <li><strong>í¬íŠ¸ ì„¤ì • ì˜¤ë¥˜</strong>: <span class="inline-code">$PORT</span> í™˜ê²½ë³€ìˆ˜ë¥¼ ì •ìˆ˜ë¡œ ë³€í™˜í•˜ì§€ ëª»í•¨</li>
                    <li><strong>Dockerfile ëˆ„ë½</strong>: Railwayê°€ ë¹Œë“œí•  Dockerfileì´ ì—†ìŒ</li>
                    <li><strong>Health check ì‹¤íŒ¨</strong>: 502 ì—ëŸ¬ ë°œìƒ</li>
                </ol>
            </div>

            <div class="solution-section">
                <h2>âœ… í•´ê²° ë°©ë²•</h2>
                
                <h3><span class="step-number">1</span>Dockerfile ìƒì„±</h3>
                <div class="file-header">
                    <span>ğŸ“„ Dockerfile</span>
                    <button class="copy-btn" onclick="copyCode('dockerfile')">ë³µì‚¬</button>
                </div>
                <pre id="dockerfile"><code># Python 3.12 slim ì´ë¯¸ì§€ ì‚¬ìš©
FROM python:3.12-slim

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /app

# ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸ ë° í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
RUN apt-get update && apt-get install -y \
    gcc \
    curl \
    && rm -rf /var/lib/apt/lists/*

# requirements.txt ë³µì‚¬ ë° íŒ¨í‚¤ì§€ ì„¤ì¹˜
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ ë³µì‚¬
COPY . .

# RailwayëŠ” PORT í™˜ê²½ë³€ìˆ˜ë¥¼ ìë™ìœ¼ë¡œ ì„¤ì •
ENV PORT=8000

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
CMD uvicorn main:app --host 0.0.0.0 --port $PORT</code></pre>

                <h3><span class="step-number">2</span>main.py ìˆ˜ì •</h3>
                <div class="file-header">
                    <span>ğŸ“„ main.py</span>
                    <button class="copy-btn" onclick="copyCode('mainpy')">ë³µì‚¬</button>
                </div>
                <pre id="mainpy"><code>import os
from fastapi import FastAPI, HTTPException
from fastapi.middleware.cors import CORSMiddleware
from pydantic import BaseModel
import httpx
import logging

# ë¡œê¹… ì„¤ì •
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

app = FastAPI()

# CORS ì„¤ì •
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# Ollama ì„œë²„ URL (í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì • ê°€ëŠ¥)
OLLAMA_URL = os.getenv("OLLAMA_URL", "http://localhost:11434")

class QueryRequest(BaseModel):
    query: str
    model: str = "llama2"

class QueryResponse(BaseModel):
    response: str
    model: str

@app.get("/")
async def root():
    return {"message": "AdMate API is running"}

@app.get("/health")
async def health_check():
    """í—¬ìŠ¤ ì²´í¬ ì—”ë“œí¬ì¸íŠ¸"""
    try:
        async with httpx.AsyncClient() as client:
            response = await client.get(f"{OLLAMA_URL}/api/tags", timeout=5.0)
            ollama_status = "connected" if response.status_code == 200 else "disconnected"
    except Exception as e:
        logger.error(f"Ollama connection error: {e}")
        ollama_status = "disconnected"
    
    return {
        "status": "healthy",
        "ollama_status": ollama_status,
        "ollama_url": OLLAMA_URL
    }

@app.post("/api/query", response_model=QueryResponse)
async def query_ollama(request: QueryRequest):
    """Ollama ëª¨ë¸ì— ì¿¼ë¦¬ë¥¼ ì „ì†¡í•˜ê³  ì‘ë‹µì„ ë°›ìŠµë‹ˆë‹¤."""
    try:
        async with httpx.AsyncClient() as client:
            response = await client.post(
                f"{OLLAMA_URL}/api/generate",
                json={
                    "model": request.model,
                    "prompt": request.query,
                    "stream": False
                },
                timeout=30.0
            )
            
            if response.status_code != 200:
                raise HTTPException(
                    status_code=response.status_code,
                    detail=f"Ollama API error: {response.text}"
                )
            
            result = response.json()
            return QueryResponse(
                response=result.get("response", ""),
                model=request.model
            )
            
    except httpx.RequestError as e:
        logger.error(f"Request error: {e}")
        raise HTTPException(
            status_code=503,
            detail=f"Ollama server is not available: {str(e)}"
        )

if __name__ == "__main__":
    import uvicorn
    
    # Railwayì—ì„œ ì œê³µí•˜ëŠ” PORT í™˜ê²½ë³€ìˆ˜ ì‚¬ìš©
    port = int(os.getenv("PORT", 8000))
    
    logger.info(f"Starting server on port {port}")
    
    uvicorn.run(
        "main:app",
        host="0.0.0.0",
        port=port,
        reload=False
    )</code></pre>

                <h3><span class="step-number">3</span>requirements.txt ìƒì„±</h3>
                <div class="file-header">
                    <span>ğŸ“„ requirements.txt</span>
                    <button class="copy-btn" onclick="copyCode('requirements')">ë³µì‚¬</button>
                </div>
                <pre id="requirements"><code>fastapi==0.104.1
uvicorn[standard]==0.24.0
httpx==0.25.1
pydantic==2.4.2
python-multipart==0.0.6</code></pre>

                <h3><span class="step-number">4</span>Railway í™˜ê²½ë³€ìˆ˜ ì„¤ì •</h3>
                <div class="env-var">
                    <p>Railway ëŒ€ì‹œë³´ë“œì—ì„œ ë‹¤ìŒ í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ì„¸ìš”:</p>
                    <div class="env-var-item">
                        <span class="env-var-name">OLLAMA_URL</span>
                        <span class="env-var-value">http://your-ollama-server:11434</span>
                    </div>
                    <div class="env-var-item">
                        <span class="env-var-name">PORT</span>
                        <span class="env-var-value">(Railwayê°€ ìë™ ì„¤ì •)</span>
                    </div>
                </div>

                <h3><span class="step-number">5</span>railway.json ìƒì„± (ì„ íƒì‚¬í•­)</h3>
                <div class="file-header">
                    <span>ğŸ“„ railway.json</span>
                    <button class="copy-btn" onclick="copyCode('railwayjson')">ë³µì‚¬</button>
                </div>
                <pre id="railwayjson"><code>{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "DOCKERFILE",
    "dockerfilePath": "Dockerfile"
  },
  "deploy": {
    "healthcheckPath": "/health",
    "healthcheckTimeout": 30,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 3
  }
}</code></pre>

                <h3><span class="step-number">6</span>.dockerignore íŒŒì¼ ìƒì„±</h3>
                <div class="file-header">
                    <span>ğŸ“„ .dockerignore</span>
                    <button class="copy-btn" onclick="copyCode('dockerignore')">ë³µì‚¬</button>
                </div>
                <pre id="dockerignore"><code>__pycache__
*.pyc
*.pyo
*.pyd
.Python
env/
venv/
.venv/
pip-log.txt
.coverage
.git
.gitignore
.mypy_cache
.pytest_cache
.idea
.vscode
*.swp
*.swo
*~
.DS_Store</code></pre>
            </div>

            <h2>ğŸš€ ë°°í¬ ë‹¨ê³„</h2>
            <ol>
                <li>
                    <strong>íŒŒì¼ë“¤ì„ GitHubì— ì¶”ê°€:</strong>
                    <pre><code>git add Dockerfile main.py requirements.txt railway.json .dockerignore
git commit -m "Fix Railway deployment issues"
git push origin main</code></pre>
                </li>
                <li>
                    <strong>Railwayì—ì„œ ì¬ë°°í¬:</strong>
                    <ul>
                        <li>Railway ëŒ€ì‹œë³´ë“œì—ì„œ "Redeploy" ë²„íŠ¼ í´ë¦­</li>
                        <li>ë˜ëŠ” ìë™ìœ¼ë¡œ ì¬ë°°í¬ê°€ ì‹œì‘ë¨</li>
                    </ul>
                </li>
                <li>
                    <strong>Ollama ì„œë²„ ì—°ê²°:</strong>
                    <ul>
                        <li>Ollamaë¥¼ ë³„ë„ ì„œë²„ì—ì„œ ì‹¤í–‰ ì¤‘ì´ì–´ì•¼ í•¨</li>
                        <li>Railwayì—ì„œ OLLAMA_URL í™˜ê²½ë³€ìˆ˜ë¡œ Ollama ì„œë²„ ì£¼ì†Œ ì„¤ì •</li>
                    </ul>
                </li>
            </ol>

            <div class="warning">
                <h3>âš ï¸ ì£¼ì˜ì‚¬í•­</h3>
                <p>RailwayëŠ” GPUë¥¼ ì§€ì›í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ Ollamaë¥¼ ì§ì ‘ ì‹¤í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ìŒ ëŒ€ì•ˆì„ ê³ ë ¤í•˜ì„¸ìš”:</p>
                <ul>
                    <li>Replicate.com ì‚¬ìš©</li>
                    <li>Google Colab + ngrok</li>
                    <li>ë¡œì»¬ ì„œë²„ + ngrok</li>
                    <li>AWS EC2 ë˜ëŠ” Google Cloud</li>
                </ul>
            </div>

            <div class="success">
                <h3>âœ¨ ì™„ë£Œ!</h3>
                <p>ìœ„ ë‹¨ê³„ë¥¼ ëª¨ë‘ ë”°ë¼í•˜ì‹œë©´ Railwayì— ì„±ê³µì ìœ¼ë¡œ ë°°í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
        </div>

        <div class="footer">
            <p>AdMate Railway ë°°í¬ ê°€ì´ë“œ</p>
            <a href="https://github.com/Jhongjin/AdMate" class="github-link" target="_blank">
                GitHub ì €ì¥ì†Œ ë³´ê¸°
            </a>
        </div>
    </div>

    <script>
        function copyCode(elementId) {
            const codeElement = document.getElementById(elementId);
            const textArea = document.createElement('textarea');
            textArea.value = codeElement.textContent;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            
            // ë³µì‚¬ ì™„ë£Œ í”¼ë“œë°±
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'âœ“ ë³µì‚¬ë¨';
            button.style.background = '#28a745';
            
            setTimeout(() => {
                button.textContent = originalText;
                button.style.background = 'rgba(255,255,255,0.2)';
            }, 2000);
        }
    </script>
</body>
</html>